<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Электронное учебное пособие Соадминистрирование баз данных и серверов</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>


  <header class="header">
    <div class="container">
      <div class="header__inner">
        <div class="header__logo">
         <img src="images/logotype-active.png" width="100px" alt="">
         <div class="name">
           <h2>Электронное учебное пособие</h2>
           <h2>Соадминистрирование баз данных и серверов</h2>
         </div>
         <a id="top"></a>
        </div>
        <nav class="nav">
          <a class="nav__link" href="index.html">Учебник</a>
          <a class="nav__link" href="basepr.html">Практика</a>
          <a class="nav__link" href="video1.html">Видеоматериал</a>
        </nav>
      </div>
    </div>
  </header>
<div class="layout">
  <aside class="aside-menu">
    <div class="block" id="block-htmlbook-block-28"><div class="block-content"></div></div>
    <div class="block" id="block-htmlbook-book-navigation">
       <h2 class="block-title">Практические задания</h2>
     <div class="block-content">
  <ul class="menu">

                               <li class="leaf-collapsed">

                         <a class="not-active" href="rabota1.html">Раздел 1. Технологии администрирования серверов и баз данных</a>
                               </li>





      <li class="leaf-collapsed">

      <a class="not-active" href="rabota1.html">Практическая Работа №1. Построение базы данных в среде одной из СУБД</a>
         </li>

     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota2.html">Практическая Работа №2. Построение схемы и словаря базы данных</a>
               </li>
               <li class="leaf-collapsed">

         <a class="not-active" href="rabota3.html">Практическая Работа №3. Изучение команд администрирования данных для среды одной из СУБД</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota4.html">Лабораторная Работа №4. Разработка требований и конфигурирование корпоративной сети </a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota5.html">Лабораторная Работа №5. Разработка механизмов сервера баз данных. Храминые процедуры</a>
               </li>
               <li class="leaf_active-trail">
                <a href="rabota6.html" class="is-active">Лабораторная Работа №6. Разработка механизмов сервера баз данных. Триггеры
               <span class="pointer" style="border-width: 11px 6px;"></span></a>
                </li>

     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota7.html">Практическая Работа №7. Установка и настройка сервера Ms SQL Server Express</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota8.html">Практическая Работа №8. Установка и настройка СУБД MY SQL</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota9.html">Практическая Работа №9. Копирование баз данных, импорт экспорт данных в среде Ms SQL Server Express средствами Management Studio </a>
               </li>
               <li class="leaf-collapsed">

               <a class="not-active" href="rabota10.html">Парктическая Работа №10. Копирование баз данных средствами команд SQL</a>
                  </li>
                  <li class="leaf-collapsed">

               <a class="not-active" href="rabota11.html">Практическая Работа №11. Перенос базы данных на другой тип сервера</a>
                     </li>
                     <li class="leaf-collapsed">

                  <a class="not-active" href="rabota12.html">Практическая Работа №12. Создание механизмов сервера для обслуживания базы данных</a>
                        </li>
                        <li class="leaf-collapsed">

                     <a class="not-active" href="rabota13.html">Практическая Работа №13. Работа с журналом аудита базы данных</a>
                           </li>
                           <li class="leaf-collapsed">

                        <a class="not-active" href="rabota14.html">Практическая Работа №14. Мониторинг нагрузки сервера</a>
                              </li>








     </div>
    </div>
 </aside>

 <div id="content" class="three-col">
   <div class="block" id="block-content">
     <div class="block-content">
       <article role="article">
         <h1 class="h1-content"><span>ЛАБОРАТОРНАЯ РАБОТА №6. РАЗРАБОТКА МЕХАНИЗМОВ СЕРВЕРА БАЗ ДАННЫХ. ТРИГГЕРЫ</span></h1>
         <nav role="navigation" aria-labelledby="book-label-2" class="book-navigation">
           <div class="page-links"><a href="rabota5.html" rel="prev" class="page-previous" title="Прошлая Тема">
             <i class="arrow icon-prev"><img src="images/arrowleft.png" alt=""></i>Практическая Работа №5</a>
             <a href="basepr.html" class="page-up" title="Содержание"><i class="arrow icon-up">
             <img src="images/arrowup.png" alt=""></i>Содержание</a>
             <a href="rabota7.html" rel="next" class="page-next" title="Следующая тема">Практическая Работа №7
               <i class="arrow icon-next"><img src="images/arrowright.png" alt=""></i>
             </a>
           </div>
         </nav>
           <div>
<h1>1. ЦЕЛЬ И ЗАДАЧИ РАБОТЫ</h1>
<p>Получить практический навык использования триггеров для организации бизнес-логики на стороне сервера</p><p>
В связи с этим задачами работы являются:</p><p>
• Изучить принципы работы и особенности построения триггеров в среде MS SQL Server.</p><p>
• Создать триггеры, выполняющие действия, согласно индивидуальному заданию.
</p>
<h1>2. ТЕОРЕТИЧЕСКИЕ ПОЛОЖЕНИЯ</h1>
<p>Триггер – это откомпилированная процедура, используемая для выполнения действий, инициируемых происходящими в базе данных событиями. Такими событиями являются запросы к базе данным, генерируемые операторами языка манипуляции данными – DML (INSERT, DELETE или UPDATE). Триггер может выполняться вместо или после операторов. С помощью триггеров можно отменять транзакции, а также модифицировать данные одних таблиц и читать данные других даже из других баз данных. Таким образом, результатом работы триггеров является обеспечение целостности базы данных.</p><p>
Чаще всего триггеры использовать очень удобно, однако, их использование приводит к значительному увеличению числа операций ввода-вывода. Триггеры не следует использовать тогда, когда сохраненная процедура или программа может добиться тех же результатов с меньшими накладными расходами.
</p><p>В Microsoft SQL Server синтаксис оператора для создания триггера выглядит следующим образом.
</p>
<a class="code">CREATE TRIGGER имяТриггера
  ON имяТаблицыПредставления
{{FOR|AFTER|INSTEAD OF} {[INSERT], [DELETE], [UP-DATE]} <br>
AS операторыSQL<br>
[IF UPDATE (ПОЛЕ) [{AND|OR} UPDATE (ПОЛЕ)]] и тд<br>
<br>
Изменеие триггера<br>
ALTER TRIGGER имяТриггера On ………<br>
<br>

Удаление триггера:<br>
DROP TRIGGER имяТриггера
</a>
<p>Триггер может быть создан только в текущей базе данных, но допускается обращение внутри триггера к другим базам данных, в том числе и расположенным на удаленном сервере.
</p><p>
Имя триггера должно быть уникальным в пределах базы данных. Дополнительно можно указать имя владельца.
</p><p>
При использовании триггеров, действия, выполняемые с таблицами, предварительно выполняются с временными таблицами. При вставке строк данные предварительно помещаются в таблицу inserted, при удалении – удаляемые данные помещаются в таблицу deleted, аналогично при модификации данных.
</p><p>
Работа триггера строится на предварительном контроле вводимых, удаляемых или модифицируемых данных с помощью временных таблиц. Данные таблицы имеют такую же структуру, как и таблицы, на которые создаются соответствующие триггеры.
</p><p>
Пример 1
</p><p>
Использование триггера для реализации ограничений на значение. В добавляемой в таблицу Сделказаписи количество проданного товара должно быть не меньше, чем его остаток из таблицы Склад.
</p><p>
Команда вставки записи в таблицу Сделка может быть, например, такой:
</p>
<a class="code">INSERT INTO Сделка VALUES (3,1,-299,»01/08/2002»)</a>
<p>Создаваемый триггер должен отреагировать на ее выполнение следующим образом: необходимо отменить команду, если в таблице Склад величина остатка товара оказалась меньше продаваемого количества товара с введенным кодом (в примере код товара=3). Во вставляемой записи количество товара указывается со знаком «+», если товар поставляется, и со знаком «-», если он продается. Пред ставленный триггер настроен на обработку только одной добавляемой записи.</p>
<a class="code">CREATE TRIGGER Триггер_ins<br>
  ON Сделка FOR INSERT AS<br>
IF @@ROWCOUNT=1 <br>
BEGIN<br>
IF NOT EXISTS(SELECT * FROM inserted<br>
WHERE	-inserted.количество<=ALL(SELECT Склад.Остаток<br>
FROM Склад,Сделка<br>
WHERE Склад.КодТовара= Сделка.КодТовара)) <br>
BEGIN<br>
ROLLBACK TRAN<br>
PRINT «Отмена поставки: товара на складе нет» END <br>
END<br>
</a>
<p>Пример 2</p><p>
Создать триггер для обработки операции удаления записи из таблицы Сделка, например, такой команды:
</p>


<a class="code">DELETE FROM Сделка WHERE КодСделки=4</a>
<p>Для товара, код которого указан при удалении записи, необходимо откорректировать его остаток на складе. Триггер обрабатывает только одну удаляемую запись.</p>

<a class="code">CREATE TRIGGER Триггер_del <br>
  ON Сделка FOR DELETE AS<br>
IF @@ROWCOUNT=1 -- удалена одна запись <br>
BEGIN<br>
DECLARE @y INT,@x INT<br>
--определяется код и количество товара из удаленной <br>
--из таблицы Склад записи<br>
SELECT @y=КодТовара, @x=Количество <br>
FROM deleted<br>
--в таблице Склад корректируется количество товара <br>
UPDATE Склад<br>
SET Остаток=Остаток-@x <br>
WHERE КодТовара=@y <br>
END <br>
</a>
<p>В среде SQL server триггер можно построить в приложении Management Studio: В контекстном меню таблицы, на которую создается триггер (конМеню→ВсеЗадачи→ManageTriggers)
</p><p>
Или выполнением запроса соответствующего содержания из любого доступного приложения, например в Query Analyzer.
</p>
<h1>3. ПОРЯДОК ВЫПОЛНЕНИЯ РАБОТЫ</h1>
<p>1. Определить событие, на которое должен реагировать триггер.</p><p>
2. Определить тип триггера, то есть он должен отреагировать на событие после его совершения или вместо его.</p><p>
3. Выявить операции сравнения, выявляющие ситуацию в которой происходит триггер.</p><p>
4. Выявить действия, которые он выполняет. 5. Создать триггеры на сервере.</p><p>
6. Разработать контрольные примеры, обеспечивающие демонстрацию работы триггера.</p><p>
7. Продемонстрировать работу триггера на контрольных примерах.</p><p>
8. Защитить работу.
</p>

<h1>4. ЗАДАНИЕ</h1>
<p>Заданием для работы является создание триггеров на таблицы базы данных по заданным требованиям.</p><p>
1. Создать триггер, для самой модифицируемой таблицы. Триггер должен вести журнал изменений (журнал – отдельная таблице).</p><p>
2. Создать триггеры, препятствующие вставке в отношении определенных кортежей, не отвечающих заданным требованиям, предъявляемым к значению каких либо атрибутов.</p><p>
3. Создать триггер препятствующий изменению численного атрибута отношения выходящего за определенные установленные рамки.</p><p>
4. Создать триггер, выполняющий каскадное удаление кортежей с внешними ключей из таблицы, с которыми связаны удаленные кортежи с первичными ключами в исходной таблице, если в ней таких кортежей больше не осталось.
</p>



<h1>5. КОНТРОЛЬНЫЕ ВОПРОСЫ</h1>
<p>1. Что такое триггер? На какие события создаются триггеры СУБД MS SQL Server?</p><p>
2. Какие действия может выполнять триггер? 3. Общий формат команды создания триггера.</p><p>
4. На каком принципе построена логика работы триггеров?
</p>



     </div>
     <nav role="navigation" aria-labelledby="book-label-2" class="book-navigation">
       <div class="page-links"><a href="rabota5.html" rel="prev" class="page-previous" title="Прошлая Тема">
         <i class="arrow icon-prev"><img src="images/arrowleft.png" alt=""></i>Практическая Работа №5</a>
         <a href="basepr.html" class="page-up" title="Содержание"><i class="arrow icon-up">
         <img src="images/arrowup.png" alt=""></i>Содержание</a>
         <a href="rabota7.html" rel="next" class="page-next" title="Следующая тема">Практическая Работа №7
           <i class="arrow icon-next"><img src="images/arrowright.png" alt=""></i>
         </a>
       </div>
     </nav>
   </article>
 </div>
</div>
  </div>
</div>
<footer>
  <div class="footer">

  <div class="footer-inner">
    <div class="footer-ss">
     <div class="footer-name">
        <a href="https://nggtk.ru"> <p class="footer-name"><i class="arrow icon-up">
        <img src="images/icon1.png" alt=""></i>Сайт ГАПОУ НГТК</p> </a>
    <a href="https://vk.com/gapou_ngtk"> <p class="footer-name"><i class="arrow icon-up">
    <img src="images/icon2.png" alt=""></i>Группа ГАПОУ НГТК в ВК</p> </a>
     </div>

    </div>
    <div>
      <p>Создано Максяшкиным Валерием Валерьевичем <br>
      С помощью текстового редактора Atom</p>
    </div>
      <a href="#top"class="top">Back to top</a>
  </div>
</div>

</footer>

</body>

</html>
