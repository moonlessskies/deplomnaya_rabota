<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Электронное учебное пособие Соадминистрирование баз данных и серверов</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>


  <header class="header">
    <div class="container">
      <div class="header__inner">
        <div class="header__logo">
         <img src="images/logotype-active.png" width="100px" alt="">
         <div class="name">
           <h2>Электронное учебное пособие</h2>
           <h2>Соадминистрирование баз данных и серверов</h2>
         </div>
         <a id="top"></a>
        </div>
        <nav class="nav">
          <a class="nav__link" href="index.html">Учебник</a>
          <a class="nav__link" href="basepr.html">Практика</a>
          <a class="nav__link" href="video1.html">Видеоматериал</a>
        </nav>
      </div>
    </div>
  </header>
<div class="layout">
  <aside class="aside-menu">
    <div class="block" id="block-htmlbook-block-28"><div class="block-content"></div></div>
    <div class="block" id="block-htmlbook-book-navigation">
       <h2 class="block-title">Практические задания</h2>
     <div class="block-content">
  <ul class="menu">

                               <li class="leaf-collapsed">

                         <a class="not-active" href="rabota1.html">Раздел 1. Технологии администрирования серверов и баз данных</a>
                               </li>


                               <li class="leaf-collapsed">

                             <a class="not-active" href="rabota1.html">Практическая Работа №1. Построение базы данных в среде одной из СУБД</a>
                                  </li>



     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota2.html">Практическая Работа №2. Построение схемы и словаря базы данных</a>
               </li>
               <li class="leaf-collapsed">

         <a class="not-active" href="rabota3.html">Практическая Работа №3. Изучение команд администрирования данных для среды одной из СУБД</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota4.html">Лабораторная Работа №4. Разработка требований и конфигурирование корпоративной сети </a>
               </li>
               <li class="leaf_active-trail">
                <a href="rabota5.html" class="is-active">Лабораторная Работа №5. Разработка механизмов сервера баз данных. Храминые процедуры
               <span class="pointer" style="border-width: 11px 6px;"></span></a>
                </li>

     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota6.html">Лабораторная Работа №6. Разработка механизмов сервера баз данных. Триггеры</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota7.html">Практическая Работа №7. Установка и настройка сервера Ms SQL Server Express</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota8.html">Практическая Работа №8. Установка и настройка СУБД MY SQL</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="rabota9.html">Практическая Работа №9. Копирование баз данных, импорт экспорт данных в среде Ms SQL Server Express средствами Management Studio </a>
               </li>
               <li class="leaf-collapsed">

               <a class="not-active" href="rabota10.html">Парктическая Работа №10. Копирование баз данных средствами команд SQL</a>
                  </li>
                  <li class="leaf-collapsed">

               <a class="not-active" href="rabota11.html">Практическая Работа №11. Перенос базы данных на другой тип сервера</a>
                     </li>
                     <li class="leaf-collapsed">

                  <a class="not-active" href="rabota12.html">Практическая Работа №12. Создание механизмов сервера для обслуживания базы данных</a>
                        </li>
                        <li class="leaf-collapsed">

                     <a class="not-active" href="rabota13.html">Практическая Работа №13. Работа с журналом аудита базы данных</a>
                           </li>
                           <li class="leaf-collapsed">

                        <a class="not-active" href="rabota14.html">Практическая Работа №14. Мониторинг нагрузки сервера</a>
                              </li>








     </div>
    </div>
 </aside>

 <div id="content" class="three-col">
   <div class="block" id="block-content">
     <div class="block-content">
       <article role="article">
         <h1 class="h1-content"><span>Лабораторная Работа №5. Разработка механизмов сервера баз данных. Храминые процедуры</span></h1>
         <nav role="navigation" aria-labelledby="book-label-2" class="book-navigation">
           <div class="page-links"><a href="rabota4.html" rel="prev" class="page-previous" title="Прошлая Тема">
             <i class="arrow icon-prev"><img src="images/arrowleft.png" alt=""></i>Лабораторная Работа №4</a>
             <a href="basepr.html" class="page-up" title="Содержание"><i class="arrow icon-up">
             <img src="images/arrowup.png" alt=""></i>Содержание</a>
             <a href="rabota6.html" rel="next" class="page-next" title="Следующая тема">Лабораторная Работа №6
               <i class="arrow icon-next"><img src="images/arrowright.png" alt=""></i>
             </a>
           </div>
         </nav>
           <div>
<h1>1. ЦЕЛЬ РАБОТЫ</h1>

<p>Получить практических навык организации бизнес-логики на стороне сервера, на основе использования хранимых процедур и пользовательских функций. </p><p>
В связи с этим задачами работы являются: </p><p>
1. Изучение принципов работы и создание хранимых процедур и пользовательских функций в среде MS SQL Server. </p><p>
2. Создание хранимых процедур и пользовательских функций в соответствии с заданием к лабораторной работе.
</p>

<h1>2. ТЕОРЕТИЧЕСКИЕ ПОЛОЖЕНИЯ</h1>

<p>Для реализации бизнес логики на стороне сервера используются, так называемые «механизмы сервера», включающие хранимые процедуры, пользовательские функции, триггеры, и другие объекты их состав может быть различен для СУБД различных производителей.</p><p>
Наиболее распространенное средство реализации бизнес-логики – хранимые процедуры сервера.</p><p>
Хранимые процедуры – это модули, хранящиеся непосредственно в базе данных в откомпилированном виде и которые могут запускаться пользователями или приложениями, работающими с базой данных. Хранимые процедуры обычно пишутся либо на специальном процедурном расширении языка SQL (например, PL/SQL для ORACLE или Transact-SQL для MS SQL Server), или на некотором универсальном языке программирования, например, C++, с включением в код операторов SQL в соответствии со специальными правилами такого включения. Основное назначение хранимых процедур – реализация бизнес-процессов предметной области на стороне сервера.</p><p>
Процедура подразумевает выполнение не только обычных запросов SQL, но и более сложную обработку, связанную с вычислениями, переходами, сравнениями ветвлениями. Для этого существует расширение SQL включающее описание переменных, операторы ветвления, циклы и пр.</p>
<h2>Создание хранимой процедуры</h2>
<p><a class="code">CREATE PROCedure [владелец.]имя_процедуры <br>
  [@параметр1], <br>
[@параметр2] <br>
AS <br>
Операторы_SQL<br>
где параметр	– @имя_параматра тип_данных [=default] [OUTPUT];
</a>
</p>
<p>[=default]– значение по умолчанию присеваемое параметру, при отсутствии передаваемого значения;</p><p>
[OUTPUT]– ключевое слово, указывающее, что при изменении параметра в ходе выполнения процедуры новое значение возвращается в переменную, используемую для вызова этой процедуры.
</p><p>
Процедура может быть создана только в текущей базе данных, за исключением временных процедур, которые создаются в tempdb. Для создания временных процедур следует начинать ее имя с «#» или «##». Длина имени хранимой процедуры вместе с ## не может превышать 20 символов. Одна процедура может вызывать другую процедуру, уровень вложенности не может превышать 16, текущий уровень вложенности можно узнать из глобальной переменной @@NESTLEVEL
</p><p>
Пользователь может создавать свои системные процедуры; они начинаются с символов sp_. При попытке выполнения такой процедуры она сначала ищется в текущей базе данных, в случае же неудачи – в базе данных master. Таблицы, используемые в системной процедуре, определяемой пользователем, также сначала отыскиваются в текущей базе данных, и если это не удалось – в базе данных master.
</p><p>
Вызов хранимой процедуры осуществляется оператором EXEC, например:
</p>
<a class="code">EXEC имяПроцедуры [параметр]</a>
<p>В виде параметра может выступать как переменная, так и константа.
</p>
<p>Пример: <br> Константа:
</p>

<a class="code">EXEC СводСотрудников «Инженер»</a>
<p>Использование переменной в качестве параметра:</p>

<a class="code">DECLARE @Должность INT <br>
  SET @Должность = «Инженер» <br>
EXEC СводСотрудников @Должность
</a>

<p>Изменение хранимой процедуры</p>
<a class="code">ALTER PROCedure [владелец.]имя_процедуры <br>
  [@параметр1], <br>
  [@параметр2] AS <br>
  Операторы_SQL
</a>
<p>Удаление хранимой процедуры</p>
<a class="code">DROP PROCEDURE имя_процедуры</a>
<p>Использование переменных в хранимых процедурах
</p><p>
Для использования переменных их необходимо объявить с помощью ключевого слова DECLARE
</p>
<a class="code">DECLARE имяПерем типДаных</a>
<p>где имяПерем– идентификатор переменной. Он должен быть без пробелов. В качестве первого символа должен использоваться символ «@». В среде SQL server могут быть созданы глобальные переменные, видимые на уровне сервера, данные переменные начинаются с двух символов «@@». Локальные переменные, начинающиеся с одного символа «@» являются локальные и видимы только внутри одной транзакции. </p>
<p>Для присвоения значений переменным используется оператор Set или Select.</p><p>
Формат операторов SET и Select при присвоении значений.
</p>
<a class="code">
SET имяПерем = значение <br>
или <br>
SELECT имяПерем значение
</a>
<p>Для обращения к значению переменной в запросе используется та же конструкция SELECT</p>

<a class="code">SELECT имяПерем as синоним.</a>

<h2>Основные алгоритмические конструкции процедурного расширения языка SQL</h2>

<p>Конструкция ветвления в SQL</p>
<a class="code">IF логическоеВыражение {операторSQL | блокОпреаторовSQL} <br>
[ ELSE<br>
{ операторSQL | блокОпреаторовSQL }] Конструкция цикла<br>
WHILE <логическое_выражение><br>
{ операторSQL | блокОпреаторовSQL } [ BREAK ]<br>
{ операторSQL | блокОпреаторовSQL } [ CONTINUE ]<br>

</a>
<p>где блокОпреаторовSQL – это операторные блоки, используемые для группировки операторов в скобки BEGIN END, аналогично паскалю, бейсику, или «{}» в С++</p><p>
Для вывода результатов вычислений или значений переменных можно использовать оператор print</p><p>
Print выражение
</p><p>
T-SQL имеет набор функций, позволяющих выполнять набор математических, строковых, системных операций и операций преобразования.</p>
<p>
Преимущества использования процедур
</p><p>

Использовать хранимые процедуры целесообразнее, чем отдельные операторы SQL по следующим причинам:
</p>

<ul>
  <li>Операторы хранимой процедуры всегда находятся в базе данных. </li><li>
Операторы хранимой процедуры уже проверены и находятся в готовом для использования виде. </li><li>
Возможность использования процедур позволяет использовать модульное программирование. </li><li>
Хранимые процедуры могут вызывать другие процедуры и функции. </li><li>
Сохраненные процедуры могут вызываться любыми приложениями. </li><li>
При использовании сохраненных процедур результат ответ от базы данных как правило получается быстрее. </li><li>
Использование	процедур	принципиально	упрощено	в СУБД.
</li>
</ul>
<h2>Пользовательские функции UDF (user-defined function)</h2>
<p>Основное отличие UDF от хранимых процедур заключается в том, что функция обязательно должна вернуть хотя бы какое-то значение. К сожалению, UDF имеют некоторые ограничения. Нельзя, например, изменять данные в таблицах БД, выводить данные с помощью команд print и select. Внутри UDF нельзя использовать недетерминированные функции типа GETDATE(). В SQL Server имеется 3 типа пользовательских функций: Scalar, Multi-statement, InLine.
</p><p>
Скалярная функция может возвращать значения любого скалярного типа данных, кроме данных типа text, image, table. Такая функция может объединять несколько команд языка T-SQL, находящихся в блоке BEGIN…END, например,
</p>
<a class="code">CREATE FUNCTION FunState <br>
  (@a varchar(20)) <br>
  RETURNS varchar(20)<br>
as <br>
BEGIN <br>
IF @a IS NULL<br>
SET @a = «Not Applicable» RETURN @a<br>
END<br>
</a>
<p>Обратиться к такой функции можно с помощью конструкции select, указав вместо поля таблицы значение функции с параметром:</p>

<a class="code">

SELECT pub_name, City, dbo.FunState(state) AS State <br>
FROM dbo.publishers<br>
</a>
<p>Multi-Statement Table</p>
<p>Другой тип UDF – Multi-Statement Table-valued Function. Как следует из названия, этот тип функции возвращает тип данных table. Тело такой функции может быть достаточно сложным и включать множество операторов, находящихся между ключевыми словами BEGIN…END. В данном простом примере в БД Pubs создается функция, которая может возвращать фамилию и имя либо автора книги, либо служащего издательства.</p>
<a class="code">CREATE FUNCTION FunMult<br>
  (@b nvarchar(8)) <br>
  RETURNS @Fun_Auth table<br>
([First Name] nvarchar(80) not null, [Last Name]nvarchar(80) not null)<br>
 AS<br>
BEGIN<br>
IF @b = «author»<br>
INSERT @Fun_Auth SELECT au_fname, au_lname <br>
FROM authors<br>
ELSE IF @b = «employee»<br>
INSERT @Fun_Auth SELECT fname, lname <br>
FROM employee<br>
RETURN <br>
END
</a>
<p>В зависимости от входного параметра, указываемого в конструкции select при вызове функции, получаем разный результат, обращаясь к таблице author или к employee:</p>

<a class="code">SELECT * FROM dbo.FunMult(«author») </a>
<a class="code">SELECT * FROM dbo.FunMult(«employee»)</a>

<p>Функция InLine тоже возвращает значение типа table, но отличается от Multi-Statement Table-valued тем, что может состоять только из одной команды select.</p>
<a class="code">CREATE FUNCTION FunInLine <br>
  State nvarchar(30)) <br>
  RETURNS table<br>
AS<br>
RETURN (SELECT pub_name, city <br>
FROM Pubs.dbo.publishers <br>
WHERE state = @State<br>
)
</a>
<p>Обращение к функции происходит в предложении from конструкции select:</p>

<a class="code">SELECT * FROM FunInLine(«Texas»)</a>
<p>Удаление функции</p>

<a class="code">DROP FUNCTION Имя функции</a>
<p>Особенностью функции InLine является то, что код функции при выполнении программы вставляется непосредственно в исполняемый набор команд. Другими словами, происходит не вызов функции, а встраивание.
</p><p>
В среде SQL server хранимую процедуру или функцию можно создать в приложении Management Studio в разделе хранимых процедур с помощью контекстного меню. Или выполнением запроса соответствующего содержания из любого доступного приложения, например в Query Analyzer.
</p>

<h1>3. ПОРЯДОК ВЫПОЛНЕНИЯ РАБОТЫ</h1>

<p>1. Уточнить задание применительно к сформированным отношениям.</p><p>
2. Схематично описать необходимые запросы по заданию для своей БД.
</p>
<p>3. Утвердить у преподавателя эскиз лабораторной работы.</p><p>
4. Создать хранимые процедуры и функции с использованием описанных операторов в методичке (также использовать по одной из стандартных функций по выбору преподавателя).</p><p>
5. Подготовить и предоставить контрольные примеры с использованием хранимых процедур.
</p>
<h1>4. ЗАДАНИЯ</h1>
<p>1. Создать хранимую процедуру, в которой будет выполняться гибкий запрос на группировку по различным полям в зависимости от входного параметра</p><p>
2. Создать пользовательскую функцию, которая возвращает значение, вычисленное, на основе одного или нескольких атрибутов отношения по заданным критериям поиска.</p><p>
3. Создать хранимую процедуру, использующую созданную пользовательскую функцию.</p><p>
4. Создать хранимые процедуры для вставки, изменения и удаления данных, переданных через входные параметры.
</p>
<h1>5. КОНТРОЛЬНЫЕ ВОПРОСЫ</h1>
<p>1. Что такое хранимая процедура, общий формат описания и вызов?</p><p>
2. Каков формат описания переменных в хранимых процедурах?</p><p>
3. Тип параметров функций и процедур.</p><p>
4. Описать типы пользовательских функций.</p><p>
5. Формат описания конструкций цикла и ветвления.</p><p>
6. Чем отличается хранимая процедура от пользовательской функции?</p><p>
7. Что дает использование ХП при разработке БД?</p>




     </div>
     <nav role="navigation" aria-labelledby="book-label-2" class="book-navigation">
       <div class="page-links"><a href="rabota4.html" rel="prev" class="page-previous" title="Прошлая Тема">
         <i class="arrow icon-prev"><img src="images/arrowleft.png" alt=""></i>Лабораторная Работа №4</a>
         <a href="basepr.html" class="page-up" title="Содержание"><i class="arrow icon-up">
         <img src="images/arrowup.png" alt=""></i>Содержание</a>
         <a href="rabota6.html" rel="next" class="page-next" title="Следующая тема">Лабораторная Работа №6
           <i class="arrow icon-next"><img src="images/arrowright.png" alt=""></i>
         </a>
       </div>
     </nav>
   </article>
 </div>
</div>
  </div>
</div>
<footer>
  <div class="footer">

  <div class="footer-inner">
    <div class="footer-ss">
     <div class="footer-name">
        <a href="https://nggtk.ru"> <p class="footer-name"><i class="arrow icon-up">
        <img src="images/icon1.png" alt=""></i>Сайт ГАПОУ НГТК</p> </a>
    <a href="https://vk.com/gapou_ngtk"> <p class="footer-name"><i class="arrow icon-up">
    <img src="images/icon2.png" alt=""></i>Группа ГАПОУ НГТК в ВК</p> </a>
     </div>

    </div>
    <div>
      <p>Создано Максяшкиным Валерием Валерьевичем <br>
      С помощью текстового редактора Atom</p>
    </div>
      <a href="#top"class="top">Back to top</a>
  </div>
</div>

</footer>

</body>

</html>
