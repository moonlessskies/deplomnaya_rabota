<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Электронное учебное пособие Соадминистрирование баз данных и серверов</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>


  <header class="header">
    <div class="container">
      <div class="header__inner">
        <div class="header__logo">
         <img src="images/logotype-active.png" width="100px" alt="">
         <div class="name">
           <h2>Электронное учебное пособие</h2>
           <h2>Соадминистрирование баз данных и серверов</h2>
         </div>
         <a id="top"></a>
        </div>
        <nav class="nav">
          <a class="nav__link" href="index.html">Учебник</a>
          <a class="nav__link" href="basepr.html">Практика</a>
          <a class="nav__link" href="video1.html">Видео материал</a>
        </nav>
      </div>
    </div>
  </header>
<div class="layout">
  <aside class="aside-menu">
    <div class="block" id="block-htmlbook-block-28"><div class="block-content"></div></div>
    <div class="block" id="block-htmlbook-book-navigation">
       <h2 class="block-title">Содержание</h2>
     <div class="block-content">
  <ul class="menu">
                 <li class="leaf-collapsed">

                 <a class="not-active" href="index.html">Раздел 1. Технологии администрирования серверов и баз данных</a>
                    </li>
                    <li class="leaf-collapsed">

                 <a class="not-active">Тема 1.1. Принципы построения и администрирования баз данных
                        </a>
                       </li>
                         <div class="sub-menu">
                           <li class="leaf-collapsed">

                        <a class="not-active" href="book111.html">1.Обязанности администратора баз данных. Основные утилиты администратора баз данных. Режимы запуска и останова базы данных./a>
                              </li>

     	      <li class="leaf-collapsed">

         <a class="not-active" href="book112.html">2.Пользователи базы данных. Привилегии, назначение привилегий. Управление пользователями баз данных</a>
               </li>
               <li class="leaf-collapsed">

         <a class="not-active" href="book113.html">3.Табличные пространства и файлы данных. Модели и типы данных.</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="book114.html">4.Схемы и объекты схемы данных. Блоки данных, экстенты сегменты.</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="book115.html">5.Структуры памяти. Однопроцессорные и многопроцессорные базы данных</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="book116.html">6.Транзакции, блокировки и согласованность данных</a>
               </li>
               <li class="leaf_active-trail">
        <a href="book117.html" class="is-active">7.Журнал базы данных: структура и назначение файлов журнала, управление переключениями и контрольными точками
               <span class="pointer" style="border-width: 11px 6px;"></span></a>
              </li>

     	      <li class="leaf-collapsed">

         <a class="not-active" href="book118.html">8. Словарь данных: назначение, структура, префиксы </a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="book119.html">9. Правила Дейта</a>
               </li>
             </div>

     	      <li class="leaf-collapsed">

         <a class="not-active">Тема 1.2. Серверы баз данных</a>
               </li>

               <div class="sub-menu">

     	      <li class="leaf-collapsed">


         <a class="not-active" href="book121.html">1.Понятие сервера. Классификация серверов. Принципы разделения между клиентскими и серверными частями. Типовое разделение функций</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="book122.html">2.Протоколы удаленного вызова процедур. Требования к аппаратным возможностям и базовому программному обеспечению клиентов и серверов</a>
               </li>
     	      <li class="leaf-collapsed">
         <a class="not-active" href="book123.html">3.Хранимые процедуры и триггеры</a>
               </li>
     	      <li class="leaf-collapsed">

         <a class="not-active" href="book124.html">4.Характеристики серверов баз данных. Механизмы доступа к базам данных</a>
               </li>
               <li class="leaf-collapsed">
              <a class="not-active" href="book125.html">5. Аппаратное обеспечение. Для квалификации «Администратор баз данных»: Развертывание серверов баз данных</a>
                  </li>
                  <li class="leaf-collapsed">
                 <a class="not-active" href="book126.html">6. Банк данных: состав, схема</a>
                     </li>
             </div>
             <li class="leaf-collapsed">
          <a class="not-active">Тема 1.3.Администрирование баз данных и серверов</a>
                </li>
     <div class="sub-menu">
      <li class="leaf-collapsed">
      <a class="not-active" href="book131.html">1.Технология установки и настройка сервера MySQL в операционной системе Windows.Клиентские настройки, протоколирование, безопасность</a>
         </li>
         <li class="leaf-collapsed">
      <a class="not-active" href="book132.html">2.Технология установки и настройка сервера MySQL в операционных системах Linux</a>
            </li>
            <li class="leaf-collapsed">
         <a class="not-active" href="book133.html">3.Удаленное администрирование</a>
               </li>
               <li class="leaf-collapsed">
            <a class="not-active" href="book134.html">4.Аудит базы данных. Аудиторский журнал. Установка опций, включение и отключение аудита. Очистка и уменьшение размеров журнала</a>
                  </li>
                  <li class="leaf-collapsed">
               <a class="not-active" href="book135.html">5.Технологии создания базы данных с применением языка SQL.Добавление, удаление данных и таблиц</a>
                     </li>
                     <li class="leaf-collapsed">
                  <a class="not-active" href="book136.html">6.Создание запросов, процедур и триггеров. Для квалификации «Администратор баз данных». Создание запросов и процедур на изменение структуры базы данных</a>
                        </li>
                        <li class="leaf-collapsed">
                     <a class="not-active" href="book137.html">7.Динамический SQL и его операторы.</a>
                           </li>
                           <li class="leaf-collapsed">
                        <a class="not-active" href="book138.html">8.Особенности обработки данных в объектно-ориентированных базах данных</a>
                              </li>
                              <li class="leaf-collapsed">
                           <a class="not-active" href="book139.html">9. Инструменты мониторинга нагрузки сервера</a>
                                 </li>

    </div>
    <li class="leaf-collapsed">
    <a class="not-active" href="index.html">Раздел 2. Обеспечение качества и сертификация информационных систем </a>
       </li>
       <li class="leaf-collapsed">
     <a class="not-active">Тема 2.1. Защитаи сохранность информации баз данных</a>
          </li>
     <div class="sub-menu">
          <li class="leaf-collapsed">
        <a class="not-active" href="book211.html">1.Законодательство Российской Федерации в области защиты информации. Требования безопасности к серверам баз данных. Классы защиты</a>
             </li>
             <li class="leaf-collapsed">
           <a class="not-active" href="book212.html">2.Основные группы методов противодействия угрозам безопасности в корпоративных сетях</a>
                </li>
                <li class="leaf-collapsed">
             <a class="not-active" href="book213.html">3.Программно-аппаратные методы защиты процесса обработки и передачи информации. Политика безопасности, настройка политики безопасности</a>
                   </li>
                   <li class="leaf-collapsed">
                <a class="not-active" href="book214.html">4.Виды неисправностей систем хранения данных</a>
                      </li>
                      <li class="leaf-collapsed">
                   <a class="not-active" href="book215.html">5.Резервное копирование: цели, методы, концепции, планирование, роль журнала транзакций. Виды резервных копий</a>
                         </li>
                         <li class="leaf-collapsed">
                      <a class="not-active" href="book216.html">6.Утилиты резервного копирования </a>
                            </li>
                            <li class="leaf-collapsed">
                         <a class="not-active" href="book217.html">7.Восстановление базы данных: основные алгоритмы и этапы</a>
                               </li>
                               <li class="leaf-collapsed">
                            <a class="not-active" href="book218.html">8.Восстановление носителей. Воссоздание утраченных файлов. Полное восстановление. Неполное восстановление</a>
                                  </li>
                                  <li class="leaf-collapsed">
                               <a class="not-active" href="book219.html">9.Мониторинг активности и блокирование</a>
                                     </li>
                                     <li class="leaf-collapsed">
                                  <a class="not-active" href="book2110.html">10.Автоматизированные средства аудита</a>
                                        </li>
                                        <li class="leaf-collapsed">
                                     <a class="not-active" href="book2111.html">11.Брандмауэры</a>
                                           </li>
                                  </div>
     <li class="leaf-collapsed">
      <a class="not-active">Тема 2.2 Сертификация информационных систем</a>
        </li>
        <div class="sub-menu">
        <li class="leaf-collapsed">
         <a class="not-active" href="book221.html">1.Уровни качества программной продукции</a>
           </li>
           <li class="leaf-collapsed">
            <a class="not-active" href="book222.html">2.Требования к конфигурации серверного оборудования и локальных сетей.Оформление требований.</a>
              </li>
              <li class="leaf-collapsed">
               <a class="not-active" href="book223.html">3.Объекты информатизации, требующие обязательной сертификации программных средств и обеспечения</a>
                 </li>
                 <li class="leaf-collapsed">
                  <a class="not-active" href="book224.html">4.Сертификаты безопасности: виды, функции, срок действия. Проверка наличия сертификата безопасности</a>
                    </li>
                    <li class="leaf-collapsed">
                     <a class="not-active" href="book225.html">5. Системы сертификации. Процедура сертификации.</a>
                       </li>
                       <li class="leaf-collapsed">
                        <a class="not-active" href="book226.html">6. Платформы и центры сертификации. Сертификат разработчика. Процесс подписи и проверки кода</a>
                          </li>
                          <li class="leaf-collapsed">
                           <a class="not-active" href="book227.html">7. SSL сертификат: содержание, формирование запроса, проверка данных с помощью сервисов</a>
                             </li>
                             <li class="leaf-collapsed">
                              <a class="not-active" href="spicok.html">Список источников</a>
                                </li>
                              </div>
                                                       </ul>



     </div>
    </div>
 </aside>

 <div id="content" class="three-col">
   <div class="block" id="block-content">
     <div class="block-content">
       <article role="article">
         <h1 class="h1-content"><span>7.Журнал базы данных: структура и назначение файлов журнала, управление переключениями и контрольными точками</span></h1>
         <nav role="navigation" aria-labelledby="book-label-2" class="book-navigation">
           <div class="page-links"><a href="book116.html" rel="prev" class="page-previous" title="Прошлая Тема">
             <i class="arrow icon-prev"><img src="images/arrowleft.png" alt=""></i>Тема 1.6.</a>
             <a href="index.html" class="page-up" title="Содержание"><i class="arrow icon-up">
             <img src="images/arrowup.png" alt=""></i>Содержание</a>
             <a href="book118.html" rel="next" class="page-next" title="Следующая тема">Тема 1.8.
               <i class="arrow icon-next"><img src="images/arrowright.png" alt=""></i>
             </a>
           </div>
         </nav>
           <div>

             <h1>Ведение журналов баз данных</h1>
             <p class="img-content"><img src="images/book1172.png" alt="Рис. 1.1" width="608" height="296"></p>
             <p class="imgsign">Рис.7.1 Пример Ведения журналов</p>

<p>Надежность хранения данных во внешней памяти — одно из основных требований к СУБД. Под надежностью хранения понимается непреложная возможность СУБД восстановить последнее согласованное состояние БД после любого аппаратного или программного сбоя.
</p><p>
Поэтому для восстановления БД нужно располагать некоторой дополнительной информацией. Поддержание надежности хранения данных в БД требует избыточности хранимых данных. Избыточная часть данных, используемая для восстановления БД после сбоев, должна храниться особо надежно. Основным методом поддержания такой избыточной информации является ведение журнала БД.
</p><p>
Журнал БД — это особая часть базы данных, недоступная пользователям СУБД и поддерживаемая с особой тщательностью, в которую поступают записи обо всех изменениях основной части БД. В разных СУБД изменения БД журнализуются на разных уровнях: иногда запись в журнале соответствует некоторой логической операции изменения БД (например, операции удаления строки из таблицы реляционной БД), иногда — минимальной внутренней операции модификации страницы внешней памяти; в некоторых системах одновременно используются оба подхода.
</p><p>
Во всех случаях придерживаются стратегии «упреждающей» записи в журнал (так называемого протокола Write-ahead Log — WAL). В соответствии с протоколом запись об изменении любого объекта БД должна попасть во внешнюю память журнала раньше, чем измененный объект попадет во внешнюю память основной части БД. При корректном соблюдении в СУБД протокола WAL все проблемы восстановления БД после любого сбоя можно решить с помощью журнала.
</p><p>
Каждая БД Oracle имеет набор из двух или более журнальных файлов, называемых журналом баз данных. Для защиты самого журнала от сбоя Oracle позволяет создавать зеркальный журнал, чтобы хранить несколько копий журнала на различных дисках. Журнал базы данных состоит из двух частей: оперативного журнала и архивного журнала.
</p><p>
Оперативный журнал — это набор из двух или более оперативных журнальных файлов, хранящих все завершенные изменения, выполненные в базе данных. После завершения транзакции временно хранящиеся в буферах SGA соответствующие изменения с помощью фонового процесса LGWR заносятся в файл журнала. Архивный журнал содержит все копии оперативных журнальных файлов. После сбоя для восстановления БД совместно используют журнал и архивную копию БД.</p>
<h1>Структура журнала</h1>
<p class="img-content"><img src="images/book1173.png" alt="Рис. 1.1" width="608" height="296"></p>
<p class="imgsign">Рис.7.2 Пример Ведения журналов</p>

<p>
Структура журнала условно может быть представлена в виде некоторого последовательного файла, в котором фиксируется каждое изменение БД, которое происходит в ходе выполнения транзакции.
</p><p>
Все транзакции имеют свои внутренние номера. Каждая запись в журнале транзакций помечается номером транзакции, к которой она относится и значениями атрибутов, которые она меняет, а также команда начала и завершения транзакции.
</p><p>
Имеются два альтернативных варианта журнала транзакций:
</p><p>
Протокол с отложенными обновлениями.
</p><p>
Протокол с немедленными обновлениями.
</p><p>
Ведение журнала по принципу отложенных изменений предполагает следующий механизм выполнения транзакций:
</p><p>
Когда транзакция (T1) начинается, в протокол заносится запись 1 <T1.Begin.Transaction>.
</p><p>
На протяжении выполнения транзакции в протоколе для каждой изменяемой записи заносится новое значение: 2 <T1, TD_RECORD, атрибут, новое значение,…>, где ID_RECORD - уникальный номер записи.
</p><p>
Если все действия, из которых состоит транзакция T1, успешно выполнены, то транзакция частично фиксируется и в протокол заносится: 3 <T1.COMMIT>.
</p><p>
После того как транзакция фиксирована, записи протокола, относящиеся к T1, используются для внесения соответствующих изменений в БД.
</p><p>
Если происходит сбой, то СУБД просматривает протокол и выясняет какие транзакции необходимо переделать. Транзакцию T1 необходимо переделать, если протокол содержит обе записи (1, 3). БД может находиться в несогласованном состоянии, однако все новые значения измененных элементов данных содержатся в протоколе, и это требует повторного выполнения транзакции. Для этого используется системная процедура REDO(), которая заменяет все значения элементов данных на новые, просматривая протокол.
</p><p>
Если в протоколе не содержится команда фиксации транзакции COMMIT, то никаких действий проводить не требуется, а транзакция запускается заново.
</p><p>
Журнал транзакций:</p>
<p class="img-content"><img src="images/book1171.png" alt="Рис. 1.1" width="608" height="296"></p>
<p class="imgsign">Рис.7.3 Пример Журнала транзакций</p>


<p>Существует альтернативный механизм с немедленным выполнением предусмотренных изменений сразу в БД, а в протокол заносятся не только новые, но все и все старые значения изменяемых атрибутов. Строка в журнале транзакций выглядит так: <T1, TD_RECORD, атрибут новое значение старое значение …>. Если транзакция успешно завершена, то все изменения уже внесены в БД, а при откате транзакции выполняется системная процедура UNDO(), которая возвращает все старые значения в отмененной транзакции.
</p><p>
Для восстановления при сбое используется следующий механизм:
</p><p>
Если транзакция содержит команду начала транзакции, но не содержит команды фиксации (COMMIT), то выполняется последовательность действий, как при откате транзакции (т.е. восстанавливаются старые значения).
</p><p>
Если сбой произошел после выполнения последней команды изменения БД, но до команды фиксации, то команда фиксации выполняется, а с БД никаких изменений не происходит, т.е. работа происходит только на уровне протокола.
</p><p>
Изменения заносятся как в журнал транзакций, так и в БД не сразу, а сначала буферируются.</p>
<h2>Назначение и структура оперативных файлов журнала базы данных.</h2>
<p>Oracle использует файлы журнала базы данных для отслеживания производимых пользователями изменений данных, например изменения в блоках сегментов данных в таблицах или индексах. Каждый производящий такое изменение пользовательский процесс генерирует запись повтора, указывающую на выполненное изменение. Эта запись повтора помещается в область SGA называемую буфером журнала базы данных. Процесс LGWR записывает эти изменения в файлы на диске, называемые оперативными файлами журнала базы данных. Oracle предполагает, что существует минимум два файла журнала базы данных. Каждый из файлов журнала базы данных называется группой журнала базы данных (redo log group). В целях надежности Oracle также позволяет создавать зеркальное отображение каждого из файлов журнала базы данных. Такие зеркалированные (mirrored) файлы называются членами группы (members of the group)
</p><p>
Оперативные журналы базы данных функционируют следующим образом. Когда буфер журнала базы данных заполняется записями повторов из пользовательских процессов или если активная транзакция дает команду commit. LGWR записывает содержание буфера журнала базы данных в каждый член группы. Иногда это называется скачиванием (flushing) буфера повторов. Скачивание всего буфера журнала базы данных происходит, даже если фиксируется одна единственная активная транзакция. Записываемая группа считается текущей, потому что LGWR в настоящее время пишет в нее. LGWR вносит записи журнала базы данных в активную группу, пока она не заполнится, после чего переключается на запись в следующую группу журнала базы данных. Это называется переключением журналов (log switch). Когда заполняется и эта группа, LGWR переключается на следующую доступную группу, пока не достигнет последнего файла журнала базы данных. После его заполнения LGWR циклически возвращается назад к первой группе и продолжает вносить записи повторов.</p>
<h1>Управление переключением журнала базы данных и контрольными точками.</h1>
<p>Журнал базы данных запивается последовательно. Поскольку пользователи Oracle вносят изменения, серверный процесс генерирует повтор для восстановления изменений, произведенных в пределах пользовательской транзакции. Повтор записывается в буфер повторов. Из него LGWR записывает изменения в оперативный файл журнала базы данных. Размер файла журнала базы данных ограничен. После его заполнения LGWR должен перейти к следующему. Переключение журналов (log switch) происходит в тот момент, когда LGWR полностью заполнит группу оперативных файлов журнала базы данных и переходит на начало записи в следующей группе.
</p><p>
При каждом переключении журналов происходит несколько событий. Oracle генерирует новый порядковый номер для оперативного файла журнала базы данных, восстанавливает файл регистрации, в который собирается вносить записи LGWR. Oracle также исполняет контрольную точку. Контрольная точка возникает при каждом переключении. Контрольные точки могут также возникать чаще, чем переключение журналов. Во время контрольной точки фоновый процесс контрольной точки CKPT обновляет заголовки всех файлов данных и управляющих файлов, чтобы отразилось успешное завершение, и дает команду DBWn на скачивание измененных буферов в файлы данных. Число буферов, в которые пишет DBWn, определяется параметром FAST_START_IO_TARGET (или FAST_START_MTTR_TARGET), если он указан. Частота, с которой возникают контрольные точки, влияет на время, необходимое Oracle для восстановления экземпляра. При сбое экземпляра измененные, но не записанные на диск блоки следует восстановить из журнала базы данных. Несмотря на то, что восстановление экземпляра происходит автоматически под управлением SMON, необходимое для него время зависит от разницы во времени между контрольными точками.
</p><p>
При переключении журналов происходят следующие события. Во-первых, LGWR прекращает запись в заполненный журнал базы данных. Во вторых, CKPT дает DBWn указание скачать измененные буферы в файлы данных и, наконец, CKPT обновляет управляющие файлы и заголовки файла данных с помощью информации контрольной точки. После выполнения задач введения контрольных точек LGWR сможет начать запись в следующую группу журнала базы данных с новым порядковым номером.
</p><p>
От администратора БД мало что зависит при управлении переключением журналов. Поскольку пользователи будут всегда изменят данные, администратор БД может сделать кое-что для предотвращения записи информации о повторе. Это значит, что можно управлять частотой переключения, изменяя размер членов оперативных файлов журнала базы данных, или вручную, принудительно устанавливая переключения журналов с помощью команды alter system switch logfile. Чем больше файл, тем реже происходит переключение журналов, а чем меньше файлы члена, тем чаще это происходит.
</p><p>
Контрольная точка возникает не только в время переключения журналов, но и из-за конфигурации, при которой для CKPT задаются регулярные интервалы. Если сконфигурировать CKPT с равномерными интервалами, то контрольные точки будут возникать равномерно, так же как и переключение журналов.</p>

     </div>
     <nav role="navigation" aria-labelledby="book-label-2" class="book-navigation">
       <div class="page-links"><a href="book116.html" rel="prev" class="page-previous" title="Прошлая Тема">
         <i class="arrow icon-prev"><img src="images/arrowleft.png" alt=""></i>Тема 1.6.</a>
         <a href="index.html" class="page-up" title="Содержание"><i class="arrow icon-up">
         <img src="images/arrowup.png" alt=""></i>Содержание</a>
         <a href="book118.html" rel="next" class="page-next" title="Следующая тема">Тема 1.8.
           <i class="arrow icon-next"><img src="images/arrowright.png" alt=""></i>
         </a>
       </div>
     </nav>
   </article>
 </div>
</div>
  </div>
</div>
<footer>
  <div class="footer">

  <div class="footer-inner">
    <div class="footer-ss">
     <div class="footer-name">
        <a href="https://nggtk.ru"> <p class="footer-name"><i class="arrow icon-up">
        <img src="images/icon1.png" alt=""></i>Сайт ГАПОУ НГТК</p> </a>
    <a href="https://vk.com/gapou_ngtk"> <p class="footer-name"><i class="arrow icon-up">
    <img src="images/icon2.png" alt=""></i>Группа ГАПОУ НГТК в ВК</p> </a>
     </div>

    </div>
    <div>
      <p>Создано Максяшкиным Валерием Валерьевичем <br>
      С помощью текстового редактора Atom</p>
    </div>
      <a href="#top"class="top">Back to top</a>
  </div>
</div>
</footer>

</body>

</html>
